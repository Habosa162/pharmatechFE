<div class="employee-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-title">
        <h1 class="page-title">
          <i class="fas fa-users"></i>
          Employee Management
        </h1>
        <p class="page-subtitle">
          Manage employees, view profiles, and track employment information
        </p>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="success" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="fas fa-check-circle"></i> {{ success }}
    <button type="button" class="btn-close" (click)="clearMessages()"></button>
  </div>
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-triangle"></i> {{ error }}
    <button type="button" class="btn-close" (click)="clearMessages()"></button>
  </div>

  <!-- Employee List View -->
  <div *ngIf="activeView === 'list'" class="employee-list-view">
    <!-- Filters Section -->
    <div class="filters-section">
      <div class="card">
        <div class="card-header">
          <h6 class="card-title">
            <i class="fas fa-filter"></i>
            Filter Employees
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-group">
                <label class="form-label">Search</label>
                <input 
                  type="text" 
                  class="form-control" 
                  [(ngModel)]="searchTerm" 
                  (input)="onFilterChange()"
                  placeholder="Search by name or phone number">
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label class="form-label">Position</label>
                <select class="form-select" [(ngModel)]="selectedPosition" (change)="onFilterChange()">
                  <option value="all">All Positions</option>
                  <option *ngFor="let position of positions" [value]="position.id">
                    {{ position.name }}
                  </option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
                  <option value="all">All Status</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
            </div>
            <div class="col-md-2">
              <div class="form-group">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-outline-secondary w-100" (click)="clearFilters()">
                  <i class="fas fa-times"></i> Clear
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-header">
      <h3>
        <i class="fas fa-users"></i>
        Employees ({{ filteredEmployees.length }})
      </h3>
      <button class="btn btn-primary" (click)="showAddEmployeeModal()">
        <i class="fas fa-plus"></i>
        Add Employee
      </button>
    </div>

    <div class="content-card">
      <div *ngIf="loading" class="loading-section">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p>Loading employees...</p>
      </div>

      <div *ngIf="!loading && filteredEmployees.length === 0" class="empty-state">
        <i class="fas fa-users"></i>
        <h4>No Employees Found</h4>
        <p>Start by adding your first employee.</p>
        <button class="btn btn-primary" (click)="showAddEmployeeModal()">
          <i class="fas fa-plus"></i> Add Employee
        </button>
      </div>

      <div *ngIf="!loading && filteredEmployees.length > 0" class="employees-grid">
        <div *ngFor="let employee of filteredEmployees" class="employee-card">
          <div class="card-header">
            <div class="employee-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="employee-info">
              <h5 class="employee-name">{{ employee.name }}</h5>
              <p class="employee-position">{{ employee.positionName }}</p>
            </div>
            <div class="employee-status">
              <span class="badge" [ngClass]="getStatusClass(employee.isActive)">
                {{ getStatusText(employee.isActive) }}
              </span>
            </div>
          </div>
          <div class="card-body">
            <div class="employee-details">
              <div class="detail-item">
                <i class="fas fa-phone"></i>
                <span>{{ employee.phoneNumber }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-dollar-sign"></i>
                <span>${{ employee.salary.toFixed(2) }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-calendar"></i>
                <span>{{ getEmploymentDuration(employee.startDate, employee.endDate) }}</span>
              </div>
            </div>
            <div class="employee-actions">
              <button class="btn btn-sm btn-outline-primary" (click)="showEmployeeProfile(employee)">
                <i class="fas fa-eye"></i> View Profile
              </button>
              <div class="action-buttons">
                <button class="btn btn-sm btn-outline-secondary" (click)="showEditEmployeeModal(employee)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteEmployee(employee.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Employee Profile View -->
  <div *ngIf="activeView === 'profile' && selectedEmployee" class="employee-profile-view">
    <div class="profile-header">
      <button class="btn btn-outline-secondary" (click)="backToList()">
        <i class="fas fa-arrow-left"></i> Back to List
      </button>
      <div class="profile-actions">
        <button class="btn btn-outline-primary" (click)="showEditEmployeeModal(selectedEmployee)">
          <i class="fas fa-edit"></i> Edit Profile
        </button>
      </div>
    </div>

    <div class="profile-content">
      <div class="profile-card">
        <div class="profile-avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="profile-info">
          <h2 class="profile-name">{{ selectedEmployee.name }}</h2>
          <p class="profile-position">{{ selectedEmployee.positionName }}</p>
          <span class="badge profile-status" [ngClass]="getStatusClass(selectedEmployee.isActive)">
            {{ getStatusText(selectedEmployee.isActive) }}
          </span>
        </div>
      </div>

      <div class="profile-details">
        <div class="detail-section">
          <h4><i class="fas fa-info-circle"></i> Personal Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Phone Number</label>
              <span>{{ selectedEmployee.phoneNumber }}</span>
            </div>
            <div class="detail-item">
              <label>Salary</label>
              <span>${{ selectedEmployee.salary.toFixed(2) }}</span>
            </div>
            <div class="detail-item">
              <label>Start Date</label>
              <span>{{ selectedEmployee.startDate | date:'mediumDate' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedEmployee.endDate">
              <label>End Date</label>
              <span>{{ selectedEmployee.endDate | date:'mediumDate' }}</span>
            </div>
            <div class="detail-item">
              <label>Employment Duration</label>
              <span>{{ getEmploymentDuration(selectedEmployee.startDate, selectedEmployee.endDate) }}</span>
            </div>
            <div class="detail-item">
              <label>Department</label>
              <span>{{ selectedEmployee.departmentName }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedEmployee.appUserName">
          <h4><i class="fas fa-user-shield"></i> Account Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>User Name</label>
              <span>{{ selectedEmployee.appUserName }}</span>
            </div>
            <div class="detail-item">
              <label>User ID</label>
              <span>{{ selectedEmployee.appUserId }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Employee Modal -->
  <div *ngIf="showEmployeeModal" class="modal-overlay" (click)="closeEmployeeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h4 class="modal-title">
          <i class="fas fa-user"></i>
          {{ editingEmployee ? 'Edit Employee' : 'Add Employee' }}
        </h4>
        <button type="button" class="btn-close" (click)="closeEmployeeModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="employeeForm" (ngSubmit)="saveEmployee()">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Name *</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="name"
                  [class.is-invalid]="isFieldInvalid(employeeForm, 'name')"
                  placeholder="Enter employee name">
                <div *ngIf="isFieldInvalid(employeeForm, 'name')" class="invalid-feedback">
                  {{ getFieldError(employeeForm, 'name') }}
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Phone Number *</label>
                <input
                  type="tel"
                  class="form-control"
                  formControlName="phoneNumber"
                  [class.is-invalid]="isFieldInvalid(employeeForm, 'phoneNumber')"
                  placeholder="Enter phone number">
                <div *ngIf="isFieldInvalid(employeeForm, 'phoneNumber')" class="invalid-feedback">
                  {{ getFieldError(employeeForm, 'phoneNumber') }}
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Department *</label>
                <select
                  class="form-select"
                  formControlName="departmentId"
                  [class.is-invalid]="isFieldInvalid(employeeForm, 'departmentId')">
                  <option value="">Select department</option>
                  <option *ngFor="let department of departments" [value]="department.id">
                    {{ department.name }}
                  </option>
                </select>
                <div *ngIf="isFieldInvalid(employeeForm, 'departmentId')" class="invalid-feedback">
                  {{ getFieldError(employeeForm, 'departmentId') }}
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Position *</label>
                <select
                  class="form-select"
                  formControlName="positionId"
                  [class.is-invalid]="isFieldInvalid(employeeForm, 'positionId')">
                  <option value="">Select position</option>
                  <option *ngFor="let position of positions" [value]="position.id">
                    {{ position.name }}
                  </option>
                </select>
                <div *ngIf="isFieldInvalid(employeeForm, 'positionId')" class="invalid-feedback">
                  {{ getFieldError(employeeForm, 'positionId') }}
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Salary *</label>
                <input
                  type="number"
                  class="form-control"
                  formControlName="salary"
                  [class.is-invalid]="isFieldInvalid(employeeForm, 'salary')"
                  min="0"
                  step="0.01"
                  placeholder="0.00">
                <div *ngIf="isFieldInvalid(employeeForm, 'salary')" class="invalid-feedback">
                  {{ getFieldError(employeeForm, 'salary') }}
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Start Date *</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="startDate"
                  [class.is-invalid]="isFieldInvalid(employeeForm, 'startDate')">
                <div *ngIf="isFieldInvalid(employeeForm, 'startDate')" class="invalid-feedback">
                  {{ getFieldError(employeeForm, 'startDate') }}
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">End Date</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="endDate"
                  placeholder="Leave empty if still employed">
              </div>
            </div>
          </div>

          <div class="form-group" *ngIf="editingEmployee">
            <div class="form-check">
              <input
                type="checkbox"
                class="form-check-input"
                formControlName="isActive"
                id="employeeActive">
              <label class="form-check-label" for="employeeActive">
                Active Employee
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">User ID (Optional)</label>
            <input
              type="text"
              class="form-control"
              formControlName="appUserId"
              placeholder="Enter user ID if employee has an account">
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEmployeeModal()">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="employeeForm.invalid">
            <i class="fas fa-save"></i>
            {{ editingEmployee ? 'Update' : 'Create' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

