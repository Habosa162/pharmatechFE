<div class="prescription-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading prescription details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Error Loading Prescription</h3>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadPrescriptionDetails()">Retry</button>
  </div>

  <!-- Prescription Details -->
  <div *ngIf="prescription && !loading && !error" class="prescription-details" [class.pdf-mode]="isPdfDownloadMode">
    
    <!-- Header Section -->
    <header class="prescription-header">
      <div class="clinic-info">
        <h1 class="clinic-name">{{ prescription.clinicName }}</h1>
        <div class="prescription-title">MEDICAL PRESCRIPTION</div>
      </div>
      <div class="prescription-date">
        <span class="date-label">Date:</span>
        <span class="date-value">{{ formatDate(prescription.prescriptionDate) }}</span>
      </div>
    </header>

    <!-- Patient Information Section -->
    <section class="patient-section">
      <h2 class="section-title">
        <span class="section-icon">üë§</span>
        Patient Information
      </h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Patient Name:</span>
          <span class="info-value">{{ prescription.patientName }}</span>
        </div>
      </div>
    </section>

    <!-- Doctor Information Section -->
    <section class="doctor-section">
      <h2 class="section-title">
        <span class="section-icon">üë®‚Äç‚öïÔ∏è</span>
        Doctor Information
      </h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Doctor Name:</span>
          <span class="info-value">{{ prescription.doctorName }}</span>
        </div>
      </div>
    </section>

    <!-- Diagnosis Section -->
    <section class="diagnosis-section">
      <h2 class="section-title">
        <span class="section-icon">üîç</span>
        Diagnosis
      </h2>
      <div class="diagnosis-content">
        <p class="diagnosis-text">{{ prescription.diagnosis }}</p>
      </div>
    </section>

    <!-- Medications Section -->
    <section class="medications-section">
      <h2 class="section-title">
        <span class="section-icon">üíä</span>
        Prescribed Medications
      </h2>
      
      <div *ngIf="prescription.medications && prescription.medications.length > 0; else noMedications" class="medications-list">
        <div *ngFor="let medication of prescription.medications; let i = index" class="medication-card">
          <div class="medication-header">
            <span class="medication-number">{{ i + 1 }}.</span>
            <h3 class="medication-name">{{ medication.medicationName }}</h3>
          </div>
          
          <div class="medication-details">
            <div *ngIf="medication.dosage" class="medication-info">
              <span class="medication-label">Dosage:</span>
              <span class="medication-value">{{ medication.dosage }}</span>
            </div>
            
            <div *ngIf="medication.frequency" class="medication-info">
              <span class="medication-label">Frequency:</span>
              <span class="medication-value">{{ medication.frequency }}</span>
            </div>
            
            <div *ngIf="medication.duration" class="medication-info">
              <span class="medication-label">Duration:</span>
              <span class="medication-value">{{ medication.duration }}</span>
            </div>
            
            <div *ngIf="medication.notes" class="medication-info notes">
              <span class="medication-label">Notes:</span>
              <span class="medication-value">{{ medication.notes }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #noMedications>
        <div class="no-medications">
          <div class="no-medications-icon">üìã</div>
          <p>No medications prescribed</p>
        </div>
      </ng-template>
    </section>

    <!-- Follow-up Section -->
    <section *ngIf="prescription.followUpDate" class="followup-section">
      <h2 class="section-title">
        <span class="section-icon">üìÖ</span>
        Follow-up Information
      </h2>
      <div class="followup-content">
        <div class="info-item">
          <span class="info-label">Follow-up Date:</span>
          <span class="info-value">{{ formatDate(prescription.followUpDate) }}</span>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="prescription-footer">
      <div class="footer-note">
        <p>This prescription is valid only when signed by the prescribing physician</p>
        <p class="system-info">Generated by PharmaTech System</p>
      </div>
    </footer>
  </div>

  <!-- Action Buttons -->
  <div *ngIf="prescription && !loading && !error" class="action-buttons">
    <button 
      class="btn btn-secondary" 
      (click)="backToPatientPrescriptions()"
      title="Back to Patient Prescriptions">
      <span class="btn-icon">‚Üê</span>
      Back
    </button>
    
    <button 
      class="btn btn-outline" 
      (click)="printPrescription()"
      [disabled]="downloading"
      title="Print Prescription">
      <span class="btn-icon">üñ®Ô∏è</span>
      Print
    </button>
    
    <button 
      class="btn btn-primary" 
      (click)="downloadPrescription()"
      [disabled]="downloading"
      title="Download as PDF">
      <span class="btn-icon" [class.spinning]="downloading">
        {{ downloading ? '‚è≥' : 'üì•' }}
      </span>
      {{ downloading ? 'Generating PDF...' : 'Download PDF' }}
    </button>
  </div>
</div>
